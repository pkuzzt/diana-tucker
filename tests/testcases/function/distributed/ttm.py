import numpy as np
import tensorly as tl
from generate import generate

t = tl.tensor([[[0.000000, 1.000000, 2.000000, 10.000000, 11.000000],
                [3.000000, 4.000000, 5.000000, 12.000000, 13.000000],
                [20.000000, 21.000000, 22.000000, 30.000000, 31.000000],
                [40.000000, 41.000000, 42.000000, 50.000000, 51.000000]],
               [[6.000000, 7.000000, 8.000000, 14.000000, 15.000000],
                [9.000000, 10.000000, 11.000000, 16.000000, 17.000000],
                [23.000000, 24.000000, 25.000000, 32.000000, 33.000000],
                [43.000000, 44.000000, 45.000000, 52.000000, 53.000000]],
               [[12.000000, 13.000000, 14.000000, 18.000000, 19.000000],
                [15.000000, 16.000000, 17.000000, 20.000000, 21.000000],
                [26.000000, 27.000000, 28.000000, 34.000000, 35.000000],
                [46.000000, 47.000000, 48.000000, 54.000000, 55.000000]]])

print(t.shape)

m1 = tl.tensor([[0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15]])
m2 = tl.tensor([[0, 1], [2, 3], [4, 5]])
t = np.matmul(m1.T, tl.unfold(t, 1))
t = tl.fold(t, 1, (3, 4, 5))
t = np.matmul(m2.T, tl.unfold(t, 0))  # Reverse with diana
t = tl.fold(t, 0, (2, 4, 5))
print(t)
'''
t = 
[[[ 4752.  4896.  5040.  5888.  6032.]
  [ 5310.  5478.  5646.  6620.  6788.]
  [ 5868.  6060.  6252.  7352.  7544.]
  [ 6426.  6642.  6858.  8084.  8300.]]

 [[ 6960.  7176.  7392.  8720.  8936.]
  [ 7761.  8013.  8265.  9794. 10046.]
  [ 8562.  8850.  9138. 10868. 11156.]
  [ 9363.  9687. 10011. 11942. 12266.]]]
'''

# Generate test program
generate(t.flatten())
